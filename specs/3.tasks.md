# Development Task Checklist for flood-tide-gen

This checklist outlines the development tasks required to implement the `flood-tide-gen` library based on the design specified in `specs/2.design.md`.

## Phase 1: Core Data Structures and Parsing

- [x] **Task 1.1: Implement Core Data Structures**
    - Define `OptStr` struct in `src/gen/mod.rs`.
    - Define `MetaType` enum in `src/gen/mod.rs`.
- [x] **Task 1.2: Implement Input File Parser**
    - Implement `parse_input_file0` function in `src/gen/mod.rs`.
    - Use `BufReader` for line-by-line reading.
    - Implement `regex` patterns for option parsing.
    - Populate `Vec<OptStr>` with parsed data.
- [x] **Task 1.3: Implement Efficient String Buffer**
    - Create `GenBuffer` struct in `src/gen/gen_buffer.rs`.
    - Implement helper methods for efficient string building.

## Phase 2: Code Generation Logic

- [x] **Task 2.1: Generate Help Source (`cmd.help.rs.txt`)**
    - Implement `gen_src_help0` function in `src/gen/gen_src_help.rs`.
    - Generate `CmdOp` enum.
    - Generate `OPT_ARY` const array.
    - Generate `CmdOptConf` struct.
    - Generate `value_to_*` helper functions.
- [x] **Task 2.2: Generate Match Source (`cmd.match.rs.txt`)**
    - Implement `gen_src_match0` function in `src/gen/gen_src_match.rs`.
    - Generate the `match` statement for mapping `CmdOp` to `CmdOptConf` fields.

## Phase 3: Public API and Orchestration

- [x] **Task 3.1: Implement Type Customization Logic**
    - Define `FixupType` struct in `src/lib.rs`.
    - Define `Pasc` enum in `src/lib.rs`.
    - Implement `fix_type_ary` function in `src/lib.rs` to apply user-defined type overrides.
- [x] **Task 3.2: Create the Public API**
    - Implement the main `do_gen_src` function in `src/lib.rs`.
    - Orchestrate the calls to parsing, fixup, and generation functions.
- [x] **Task 3.3: Implement File Update Logic**
    - Implement `update_file0` function in `src/gen/mod.rs`.
    - Add logic to compare new content with existing file content before writing.

## Phase 4: Finalization

- [x] **Task 4.1: Integrate Error Handling**
    - Ensure all relevant functions return `anyhow::Result`.
    - Use `.with_context()` to add descriptive error messages.
- [x] **Task 4.2: Add Unit and Integration Tests**
    - Write unit tests for parsing logic in the `tests/` directory.
    - Create integration tests using fixture files.
    - Verify generated code against expected output.
- [x] **Task 4.3: Write Documentation**
    - Add `rustdoc` comments to all public APIs in `src/lib.rs`.
    - Update `README.md` with usage examples and instructions.
