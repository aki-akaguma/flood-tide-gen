# Requirements for flood-tide-gen

## 1. Overview

`flood-tide-gen` is a Rust library crate that generates Rust source code for command-line argument parsing. It reads a definition file, written in a human-readable format resembling a command's help text, and produces Rust code that can be used with the `flood-tide` crate to handle command-line options.

## 2. Functional Requirements

### 2.1. Input Parsing

- The library MUST parse a text file (`.txt`) that defines the command-line interface.
- The definition format includes:
    - Short options (e.g., `-h`).
    - Long options (e.g., `--help`).
    - Arguments/meta-variables for options (e.g., `<file>`).
    - A textual description for each option.
- The library MUST be able to parse options with various combinations:
    - Short option only.
    - Long option only.
    - Both short and long options.
    - Options that take an argument.
    - Flag-only options (no argument).

### 2.2. Code Generation

- The library MUST generate two distinct Rust source files:
    1.  **Help Source (`cmd.help.rs.txt`):** This file contains the data structures representing the CLI options. This includes:
        - A `const` array of `Opt` structs, defining each option's properties (short name, long name, argument presence).
        - A `CmdOp` enum mapping each option to a unique identifier.
        - A `CmdOptConf` struct to hold the parsed values from the command line.
        - Helper functions for type conversion (`value_to_*`).
    2.  **Match Source (`cmd.match.rs.txt`):** This file contains a `match` statement that maps the parsed option from `flood-tide` to the corresponding field in the `CmdOptConf` struct.

### 2.3. Type Customization

- The library MUST provide a mechanism to "fix up" or customize the data type for a given command-line option.
- By default, options with arguments are treated as `String`, and flags are `bool`.
- The user MUST be able to specify:
    - That an option's value should be collected into a `Vec<T>`.
    - That an option's value is optional (`Option<T>`).
    - A specific primitive type (e.g., `i32`, `usize`).
    - A custom type that implements `FromStr`.

### 2.4. Subcommand Support

- The generation logic MUST support different CLI structures:
    - A simple command without subcommands.
    - A parent command that has subcommands.
    - A subcommand.

### 2.5. File Handling

- The library MUST only write to the output files if the newly generated content is different from the existing file content to avoid unnecessary file modifications.

## 3. Non-Functional Requirements

- **Rust Edition:** The crate MUST use the 2021 Rust edition.
- **Rust Version:** The crate MUST be compatible with `rustc 1.56.0` or newer.
- **Dependencies:** The crate should minimize external dependencies.

## 4. External Dependencies

- **`anyhow`**: For flexible and easy-to-use error handling throughout the library.
- **`case`**: For converting string cases (e.g., from `kebab-case` in the definition file to `CamelCase` or `snake_case` in the generated code).
- **`regex`**: Used to parse the lines of the input definition file.
